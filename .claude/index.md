# Infos to Speed Up Code Analysis

This little App is built with sveltekit and helps to search for the carbohydrate content of foods (e.g. Diabetics).

As a basis for its data it uses a csv dump of the german BLS Database.

It is built as a PWA, with offline capacity.

It is built with a privacy first approach (no tracking, no ads).

We are using `pnpm` as main dep/build tool.

## Architecture: Feature-Based Modules

The codebase follows a **feature-based module structure** where each feature's components AND logic live together:

```
src/lib/
├── features/
│   ├── food/              # Food search, display, calculation
│   │   ├── Calculator.svelte
│   │   ├── FoodCard.svelte
│   │   ├── SearchBar.svelte
│   │   ├── filters.ts     # BLS category filters
│   │   ├── filters.test.ts
│   │   ├── search.ts      # Fuzzy search logic
│   │   └── search.test.ts
│   │
│   ├── custom-foods/      # Custom food management
│   │   ├── AddCustomFoodDialog.svelte
│   │   └── CustomFoodsList.svelte
│   │
│   ├── meal/              # Meal composition
│   │   ├── MealList.svelte
│   │   └── MealSummary.svelte
│   │
│   ├── settings/          # App settings UI
│   │   └── SettingsPage.svelte
│   │
│   ├── update/            # PWA update notification & SW registration
│   │   ├── UpdateNotification.svelte
│   │   ├── serviceWorker.svelte.ts  # SW registration & update detection
│   │   └── serviceWorker.test.ts
│   │
│   └── onboarding/        # Onboarding tour (driver.js)
│       └── service.ts
│
├── shared/                # Cross-feature utilities & components
│   ├── GrOrMl.svelte      # Unit display helper
│   ├── UnitDisplay.svelte # BE/KHE display component
│   ├── storage.ts         # localStorage wrapper with typed keys
│   └── storage.test.ts
│
├── stores/                # Global reactive Svelte 5 stores
│   ├── foods.svelte.ts    # Food data & custom foods
│   ├── foods.test.ts
│   ├── meal.svelte.ts     # Current meal composition
│   └── settings.svelte.ts # User preferences
│
├── styles/
│   └── app.css            # Tailwind + custom styles
│
├── types/
│   └── food.ts            # TypeScript types (FoodItem, MealItem, etc.)
│
└── version.ts             # App version & changelog notes
```

### Import Rules (follow manually, not enforced via ESLint):
- **Features can import from**: `$lib/shared/`, `$lib/stores/`, `$lib/types/`
- **Features must NOT import from**: other features directly (exception: FoodCard is reused)
- **Shared can import from**: only `$lib/shared/` itself, `$lib/types/`
- If two features need the same thing -> move it to `shared/`

## Important Directories and Files

### Documentation
- `/docs/*.md` - Feature documentation and plans
- `/docs/*.puml` - PlantUML diagrams (update notification flows, etc.)
- `/CHANGELOG.md` - Changelog (update before releases)

### Data & Scripts
- `/scripts/*.ts` - Scripts to convert BLS data to JSON
- `/scripts/bls-data/*.csv` - Source CSV data from BLS database
- `/static/lebensmittel-daten.json` - Converted food data loaded by the app

### Source Code
- `/src/lib/features/` - Feature modules (see structure above)
- `/src/lib/shared/` - Cross-cutting utilities and components
- `/src/lib/stores/` - Global Svelte 5 reactive stores ($state, $derived)
- `/src/lib/types/` - TypeScript type definitions
- `/src/lib/styles/` - CSS (imports into app.css)
- `/src/lib/version.ts` - Version number and release notes

### Routes
- `/src/routes/+layout.svelte` - Main layout, SW initialization
- `/src/routes/+page.svelte` - Main app page with tabs
- `/src/routes/legal/+page.svelte` - Legal/privacy page

### Static Assets
- `/static/fonts/` - Web fonts
- `/static/icons/*.png` - PWA icons

### PWA Configuration
- `/vite.config.ts` - VitePWA plugin config (generateSW strategy)
- Service worker is auto-generated by VitePWA, registration handled in `features/update/serviceWorker.svelte.ts`
